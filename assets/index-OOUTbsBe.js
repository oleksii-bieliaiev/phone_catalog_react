import{r as t,G as L,i as E,j as e,I as M,c as T,u as q,a as D,g as C}from"./index-_AbkKq8r.js";import{B as K,c as U}from"./Breadcrumbs-CKosi3F0.js";import{P as Z}from"./ProductsList-B3ydndtu.js";import{L as z}from"./Loader-CSOPBygH.js";import"./ProductCard-3WC0gAcM.js";const y=t.memo(({label:u,selected:p,options:a,onChange:o})=>{const{theme:r}=t.useContext(L),[s,c]=t.useState(!1),h=t.useRef(null),w=t.useCallback(()=>{c(l=>!l)},[]),_=t.useCallback(l=>{o(l),c(!1)},[o]),g=t.useCallback(l=>{var P;(P=h.current)!=null&&P.contains(l.target)||c(!1)},[]);t.useEffect(()=>{if(s)return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[s,g]);const N=E[s?"arrow_down":"arrow_right"][r];return e.jsxs("div",{ref:h,className:"dropdown",children:[e.jsx("div",{className:"dropdown__label",children:u}),e.jsxs("button",{className:`dropdown__button ${s?"dropdown__button--open":""}`,onClick:w,"aria-expanded":s,"aria-haspopup":"listbox",children:[e.jsx("span",{className:"dropdown__title",children:p}),e.jsx(M,{icon:N,className:"dropdown__icon"})]}),s&&e.jsx("ul",{className:"dropdown__options",role:"listbox",children:a.map(l=>e.jsx("li",{className:"dropdown__option",role:"option",onClick:()=>_(l),children:l},l))})]})});y.displayName="Dropdown";const b=4,Q=({total:u,perPage:p,currentPage:a,onPageChange:o})=>{const{theme:r}=t.useContext(L),s=t.useMemo(()=>Math.ceil(u/p),[u,p]),c=t.useMemo(()=>{const P=Math.floor(b/2);let m=Math.max(1,a-P);const i=Math.min(s,m+b-1);return i-m+1<b&&(m=Math.max(1,i-b+1)),{startPage:m,endPage:i}},[a,s]),h=a===1,w=a===s,_=()=>{h||o(a-1)},g=()=>{w||o(a+1)},N=(P,m,i)=>{const d=P==="prev"?"arrow_left":"arrow_right",f=`${d}__disabled`,j=m?E[f][r]:E[d][r];return e.jsx("button",{className:T("pagination__button",{"pagination__button--disabled":m}),onClick:i,disabled:m,children:e.jsx(M,{icon:j})})},l=()=>{const{startPage:P,endPage:m}=c,i=[];for(let d=P;d<=m;d++)i.push(e.jsx("button",{className:T("pagination__button-page",{"pagination__button-page--active":a===d}),onClick:()=>o(d),children:d},d));return i};return e.jsxs("div",{className:"pagination",children:[N("prev",h,_),e.jsx("div",{className:"pagination__button-container",children:l()}),N("next",w,g)]})},V=(u,{sortBy:p,query:a})=>{let o=[...u];switch(a&&(o=o.filter(r=>r.name.toLowerCase().includes(a.toLowerCase().trim()))),p){case"Newest":return o.sort((r,s)=>s.year-r.year);case"Alphabetically":return o.sort((r,s)=>r.name.localeCompare(s.name));case"Cheapest":return o.sort((r,s)=>r.fullPrice-s.fullPrice);default:return o}},W="Newest",S="All",v=1,H=["Newest","Alphabetically","Cheapest"],J=["4","8","16","All"],X=500,ae=({category:u})=>{const{allProducts:p}=t.useContext(L),[a,o]=t.useState(!1),[r,s]=t.useState(null),[c,h]=q(),w=D(),_=c.get("sort")||W,g=c.get("perPage")||S,N=Number(c.get("page"))||v,l=c.get("query")||"",P=t.useMemo(()=>w.pathname.split("/")[1],[w.pathname]),m=t.useMemo(()=>p.filter(n=>n.category===u),[p,u]),i=t.useMemo(()=>V(m,{sortBy:_,query:l}),[m,l,_]),d=i.length,f=t.useMemo(()=>{const n=g===S,x=Number(g),I=n?1:Math.ceil(d/x),$=(N-1)*x;return{isShowingAll:n,itemsPerPageNum:x,totalPages:I,startIndex:$}},[g,d,N]),j=t.useMemo(()=>{const{isShowingAll:n,startIndex:x,itemsPerPageNum:I}=f;return n?i:i.slice(x,x+I)},[i,f]),A=t.useCallback(n=>{if(n===_)return;o(!0),h(C(c,{sort:n}))},[c,h,_]),k=t.useCallback(n=>{o(!0),h(C(c,n===S?{perPage:null,page:null}:{perPage:n,page:"1"}))},[c,h]),O=t.useCallback(n=>{o(!0),window.scrollTo({top:0,behavior:"smooth"});const x=n===v?{page:null}:{page:String(n)};h(C(c,x))},[c,h]),R=t.useCallback(()=>{window.location.reload()},[]);t.useEffect(()=>{o(!0),s(null);const n=setTimeout(()=>{try{p!=null&&p.length||s("Failed to load products")}catch{s("Failed to load products")}finally{o(!1)}},X);return()=>clearTimeout(n)},[u,p,_,g,N,l]);const B=()=>e.jsxs("div",{className:"productPage__error",children:[e.jsx("p",{children:"Something went wrong. Please try again."}),e.jsx("button",{onClick:R,children:"Reload"})]}),G=()=>l?e.jsx("p",{className:"productPage__no-products",children:`There are no ${P} matching the query`}):e.jsx("div",{className:"productPage__no-products",children:e.jsxs("p",{children:["There are no ",u," yet."]})}),F=()=>e.jsxs(e.Fragment,{children:[e.jsx(K,{productType:u}),e.jsxs("h1",{className:"productPage__title",children:[U(u)," page"]}),e.jsx("span",{className:"productPage__description",children:`${d} model${d!==1?"s":""}`}),e.jsxs("div",{className:"productPage__dropdown",children:[e.jsx("div",{className:"productPage__dropdown--sortBy",children:e.jsx(y,{label:"Sort by",selected:_,options:H.slice(),onChange:A})}),e.jsx("div",{className:"productPage__dropdown--itemsPerPage",children:e.jsx(y,{label:"Items on page",selected:g,options:J.slice(),onChange:k})})]}),e.jsx(Z,{products:j,displayType:"with-discount"}),!f.isShowingAll&&f.totalPages>1&&e.jsx(Q,{total:d,perPage:f.itemsPerPageNum,currentPage:N,onPageChange:O})]});return e.jsxs("div",{className:"productPage",children:[a&&e.jsx(z,{}),!a&&r&&B(),!a&&!r&&!i.length&&G(),!a&&!r&&i.length>0&&F()]})};export{ae as ProductPage};
